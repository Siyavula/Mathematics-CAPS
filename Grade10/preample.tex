   \newenvironment{toc}%
    {\begin{description}\setlength{\topsep}{0cm}\setlength{\itemsep}{0cm}%%
    \setlength{\parskip}{0cm}\setlength{\parsep}{0cm}%%
    \setlength{\partopsep}{0cm}}
    {\end{description}}

    \newenvironment{indexheading}%
    {\begin{description}\setlength{\topsep}{0cm}\setlength{\itemsep}{0cm}%%
    \setlength{\parskip}{0cm}\setlength{\parsep}{0cm}%%
    \setlength{\partopsep}{0cm}
    \setlength{\labelwidth}{0cm}\setlength{\labelsep}{0cm}%
    \setlength{\leftmargin}{-1cm} \item[] \noindent}
    {\end{description}}

    \setlength{\marginparsep}{0pt}
    \setlength{\marginparwidth}{0pt}
    %\setlength{\}{0pt}
  
        \usepackage[paper=letterpaper, 
          lmargin=1in, rmargin=1in, 
          tmargin=1in, bmargin=1in,
          twoside,centering,
          includehead]{geometry}
      
    \usepackage{layouts}
    \usepackage{multicol}
    \usepackage{amsmath} %for \underset, \overset, and more?
    \usepackage{amssymb} %for set of reals, integers, etc..., \triangleq
    \usepackage{alltt}   %for codeblocks
    \usepackage{url} %for nice url breaks
    \usepackage{graphicx} % for figure support
    \usepackage{epstopdf}
    \usepackage{subfigure}
    \usepackage{tabularx}
    \usepackage{supertabular}
    \usepackage{xtab}
    \usepackage{multirow}
    \usepackage{float}
    \usepackage{ragged2e} 
    \usepackage{array}
    \usepackage{mathrsfs}
    \usepackage{textcomp}
    \usepackage[cjkjis,mathletters,autogenerated,tipa]{ucs}
    \usepackage{amsmath, amsthm, amsfonts, amssymb}
    \usepackage{xcolor}

    \usepackage{pst-all}
    \usepackage{pst-eucl}        %Jo
    \usepackage{pst-poly}        %Jo
    \usepackage{pst-spectra}
    \usepackage{pst-slpe}
    \usepackage{pst-math}

    %% ************* NB ************
    %% The order in which pstricks packages are loaded
    %% matters - so I copied the order from pst-all.sty
    %% and then added the two additional packages at the end.
    %% ************* End NB ************

    %% ************* Packages ************
    \usepackage{pst-circ}
    \usepackage{pst-lens}
    \usepackage{pst-optic}         %Jo
    \usepackage{pstricks-add}         %Jo
    \usepackage{pst-labo}         %Jo   
    \usepackage{auto-pst-pdf}
    \usepackage{mdframed}
    \sffamily
    \pagestyle{headings}

    
    \usepackage[utf8x]{inputenc}
    \usepackage[C40,T1]{fontenc}
    \usepackage[scaled]{helvet}           
    \renewcommand*\familydefault{\sfdefault}
        
    \usepackage{calc}
    \usepackage{ifthen}
    %\usepackage{breqn}
    \usepackage{ulem}
    \normalem

%    \setlength{\emergencystretch}{3em}
    \renewcommand{\labelenumi}{\textbf{\arabic*{enumi}.}}
    \renewcommand{\thesubfigure}{(\alph{subfigure})}
    \renewcommand{\labelitemi}{\ensuremath{\bullet} }
    \renewcommand{\labelitemii}{\ensuremath{\cdot} }
    \usepackage{enumerate}
    \usepackage{enumitem}
    \setcounter{tocdepth}{3}
    \DeclareUnicodeCharacter {9653} {\bigtriangleup}
    \DeclareUnicodeCharacter {183} {\ensuremath{\cdot}}
    \DeclareUnicodeCharacter {785} {\textasciibreve}
    \DeclareUnicodeCharacter {787} {'}
    \DeclareUnicodeCharacter {788} {`}
    \DeclareUnicodeCharacter {789} {'}
    \DeclareUnicodeCharacter {940} {[U+03AC]}
    \DeclareUnicodeCharacter {941} {[U+03AD]}
    \DeclareUnicodeCharacter {942} {[U+03AE]}
    \DeclareUnicodeCharacter {943} {[U+03AF]}
    \DeclareUnicodeCharacter {970} {\"{i}}
    \DeclareUnicodeCharacter {972} {[U+03CC]}
    \DeclareUnicodeCharacter {973} {[U+03CD]}
    \DeclareUnicodeCharacter {974} {[U+03CE]}
    \DeclareUnicodeCharacter {978}  {\ensuremath{\Upsilon}}
    \DeclareUnicodeCharacter {988}  {\ensuremath{\digamma}}
    \DeclareUnicodeCharacter {8260} {/}
    \DeclareUnicodeCharacter {8289} {}
    \DeclareUnicodeCharacter {8290} {}
    \DeclareUnicodeCharacter {8407} {\ensuremath{\rightarrow}}
    \DeclareUnicodeCharacter {8474} {\ensuremath{\mathbb{Q}}}
    \DeclareUnicodeCharacter {8484} {\ensuremath{\mathbb{Z}}}
    \DeclareUnicodeCharacter {8497} {\ensuremath{\mathcal{F}}}
    \DeclareUnicodeCharacter {8519} {\ensuremath{\mathbb {e}}}
    \DeclareUnicodeCharacter {8520} {\ensuremath{\mathbb {i}}}
    \DeclareUnicodeCharacter {8596} {\ensuremath{\leftrightarrow}}
    \DeclareUnicodeCharacter {8614} {\ensuremath{\mapsto}}
    \DeclareUnicodeCharacter {8788} {:=}
    \DeclareUnicodeCharacter {9001} {\ensuremath{\textless}}
    \DeclareUnicodeCharacter {9002} {\ensuremath{\textgreater}}   
    \DeclareUnicodeCharacter {9474} {\ensuremath{\textbar}}
    \DeclareUnicodeCharacter {10003} {\checkmark}
  
    \DeclareUnicodeCharacter {61168}{\ensuremath{\jmath}}
    \DeclareUnicodeCharacter {61237}{\ensuremath{\mathscr{A}}}
    \DeclareUnicodeCharacter {61238}{\ensuremath{\mathscr{C}}}
    \DeclareUnicodeCharacter {61239}{\ensuremath{\mathscr{D}}}
    \DeclareUnicodeCharacter {61240}{\ensuremath{\mathscr{G}}}
    \DeclareUnicodeCharacter {61241}{\ensuremath{\mathscr{J}}}
    \DeclareUnicodeCharacter {61242}{\ensuremath{\mathscr{K}}}
    \DeclareUnicodeCharacter {61243}{\ensuremath{\mathscr{N}}}
    \DeclareUnicodeCharacter {61244}{\ensuremath{\mathscr{O}}}
    \DeclareUnicodeCharacter {61245}{\ensuremath{\mathscr{P}}}
    \DeclareUnicodeCharacter {61246}{\ensuremath{\mathscr{Q}}}
    \DeclareUnicodeCharacter {61247}{\ensuremath{\mathscr{S}}}
    \DeclareUnicodeCharacter {61248}{\ensuremath{\mathscr{T}}}
    \DeclareUnicodeCharacter {61249}{\ensuremath{\mathscr{U}}}
    \DeclareUnicodeCharacter {61250}{\ensuremath{\mathscr{V}}}
    \DeclareUnicodeCharacter {61251}{\ensuremath{\mathscr{W}}}
    \DeclareUnicodeCharacter {61252}{\ensuremath{\mathscr{X}}}
    \DeclareUnicodeCharacter {61253}{\ensuremath{\mathscr{Y}}}
    \DeclareUnicodeCharacter {61254}{\ensuremath{\mathscr{Z}}}
    \DeclareUnicodeCharacter {61327}{\ensuremath{\mathbb {E}}}
    \DeclareUnicodeCharacter {61328}{\ensuremath{\mathbb {F}}}
    \DeclareUnicodeCharacter {62838}{\ensuremath{\longleftarrow}}
    \DeclareUnicodeCharacter {62839}{\ensuremath{\longrightarrow}}
    \DeclareUnicodeCharacter {62843}{\ensuremath{\leftrightarrow}}




\newenvironment{IFact}[1]%
{\vspace{3mm}\rmfamily
 \begin{center}\begin{pspicture}(0,0)(5,0.01)
 \psline[linecolor=red]{-}(0,0)(5,0)
\end{pspicture}\end{center}
%\psshadowbox{
 \begin{quote}%
\rput(-1.5,0){\psfact}\noindent #1%
\end{quote}%
 }%}
{\begin{center}\begin{pspicture}(0,0)(5,0.01)
 \psline[linecolor=red]{-}(0,-0.1)(5,-0.1)
\end{pspicture}\end{center}
\vspace{3mm}\sffamily}%


\newcommand{\Definition}[2]{
\vspace{3mm}
\begin{center}
\colorbox{lightgray}{\begin{minipage}[t]{0.80\textwidth}
\noindent%
\textbf{Definition: #1}\par
#2
\end{minipage}}
\end{center}
\vspace{3mm}}

\newcommand{\Tip}[1]{
\vspace{3mm}
\begin{center}
\colorbox{lightgray}{\begin{minipage}[t]{0.80\textwidth}
\noindent%
\textbf{Tip:}\par
#1
\end{minipage}}
\end{center}
\vspace{3mm}}

\newcommand{\Warning}[1]{
\vspace{3mm}
\begin{center}
\colorbox{lightgray}{\begin{minipage}[t]{0.80\textwidth}
\noindent%
\textbf{Warning:}\par
#1
\end{minipage}}
\end{center}
\vspace{3mm}}

\newcommand{\Note}[1]{
\vspace{3mm}
\begin{center}
\colorbox{lightgray}{\begin{minipage}[t]{0.80\textwidth}
\noindent%
\textbf{Note:}\par
#1
\end{minipage}}
\end{center}
\vspace{3mm}}

                

    \setlength{\parskip}{2ex}

    \setlength{\parindent}{0pt}

    
	\newenvironment{note}[1]%
	{\begin{list}{}{%
 	\setlength{\labelsep}{0pt}\setlength{\rightmargin}{20pt}%
        \setlength{\leftmargin}{20pt}%
	\setlength{\labelwidth}{0pt}\setlength{\listparindent}{0pt}}%
        \item\textbf{\textsc{#1}}}%
	{\end{list}}

  

    \newenvironment{cnxcaption}%
	{\begin{list}{}{%
 	\setlength{\labelsep}{0pt}\setlength{\rightmargin}{25pt}%
        \setlength{\leftmargin}{25pt}%
	\setlength{\labelwidth}{0pt}\setlength{\listparindent}{0pt}}%
        \item}%
	{\end{list}}

        \newenvironment{example}{%
          \noindent
          \begingroup
          \leftskip=20pt\rightskip=\leftskip
        }{%
          \vspace{\rubberspace}\par
          \endgroup
        }

        %\newenvironment{exercise}{\begin{example}}
        %{\end{example}}

% Inserted by MH to get step number etc. to work nicely
% My attempt to define a worked example environment
\newcounter{stepcounter}
\setcounter{stepcounter}{1}

\newcounter{workedexamplecounter}
\setcounter{workedexamplecounter}{1}

% can we deprecate the use of this, and use \westep instead
\newcommand{\westep}[1]
{\par \par%\pagebreak[1]
 \textbf{\textit{Step \arabic{stepcounter} : #1}}\par
 \addtocounter{stepcounter}{1}}


\newenvironment{wex}[3]
{% This is a picture at the beginning, a line or bar or something else
% this command puts a bar in the margin and sets the bar width
% Now we set margins
% \begin{center}
%\pagebreak
%\begin{flushleft}
%\begin{pspicture}(0,0)(10,0.01)
% \psline[linecolor=gray,linewidth=3pt]{-}(0,0)(10,0)
% \psline[linecolor=gray]{-}(0,0)(0,-2)
%\end{pspicture}
%\end{flushleft}
%\end{center}
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
%% Title and counter
\rput(-2.0,0){\pspencil}\noindent
%\begin{mdframed}[linewidth =2,margin=40]
\textbf{\textit{Worked Example \arabic{workedexamplecounter}: }
#1}\par
\textbf{Question:} #2\par
\textbf{Answer}\par #3%
\addtocounter{workedexamplecounter}{1}\setcounter{stepcounter}{1}%
\par%\vspace{.25cm}
}%
{%
%\end{mdframed}
\end{quotation}
%\nopagebreak[4]
\begin{flushright}
%\begin{pspicture}(0,0)(10,0.01)
% \psline[linecolor=gray,linewidth=3pt]{-}(0,0)(10,0)
% \psline[linecolor=gray]{-}(10,0)(10,2)
%\end{pspicture}
\end{flushright}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{exercises}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Exercises:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{eocexercises}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Exercises:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{f_experiment}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Formal Experiment:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{i_experiment}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Informal Experiment:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{g_experiment}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{General Experiment:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{activity}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Activity:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{groupdiscussion}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Group Discussion:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}


\newenvironment{casestudy}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Case Study:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{project}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Project:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}

\newenvironment{Investigation}[1]
{
\begin{quotation}
\noindent
\vspace{.5cm}
\setlength{\parindent}{0pt}
\textbf{\textit{Investigation:}
#1}\par
}%
{%
\end{quotation}
\setlength{\parindent}{\saveparindentlength}}




        \newenvironment{cnxrule}{\begin{example}}
        {\end{example}}

\newenvironment{exercise}{\textbf{\par Needs to be changed to wex environment\par}\begin{example}}
        {\end{example}}


        \newenvironment{definition}{\begin{example}}
        {\end{example}}

        \newenvironment{listname}{\vspace{\rubberspace}\par\noindent{}}{\vspace*{0pt}
        \nopagebreak}

    \newcommand{\lessthan}{\ensuremath{<}}
    \newcommand{\greatthan}{\ensuremath{>}}

    % --------------------------------------------
    % Hacks for honouring row/entry/@align
    % (\hspace not effective when in paragraph mode)
    % Naming convention for these macros is:
    % 'docbooktolatex' 'align' {alignment-type} {position-within-entry}
    % where r = right, l = left, c = centre
    \newcommand{\docbooktolatexalign}[2]{\protect\ifvmode#1\else\ifx\LT@@tabarray\@undefined#2\else#1\fi\fi}
    \newcommand{\docbooktolatexalignll}{\docbooktolatexalign{\raggedright}{}}
    \newcommand{\docbooktolatexalignlr}{\docbooktolatexalign{}{\hspace*\fill}}
    \newcommand{\docbooktolatexaligncl}{\docbooktolatexalign{\centering}{\hfill}}
    \newcommand{\docbooktolatexaligncr}{\docbooktolatexalign{}{\hspace*\fill}}
    \newcommand{\docbooktolatexalignrl}{\protect\ifvmode\raggedleft\else\hfill\fi}
    \newcommand{\docbooktolatexalignrr}{}

    % ------------------------------------------
    % Break long chapter titles in running heads
    \makeatletter
      \def\@evenhead{\thepage\hfil\parbox{5in}{\raggedleft\slshape\leftmark}}%
    \makeatother

    % ------------------------------------------
    % Lengths etc. for tables
    \newlength\mytablewidth  % full width of table
    \newlength\mytablespace  % non-content hspace in table (tabcolseps and rule widths)
    \newlength\mytableroom   % content hspace in table
    \newlength\mycolwidth
    \newlength\myfixedwidth  % sum of widths of columns that have fixed widths
    \newlength\mystarwidth   % length of one star factor
    \newlength\myspanwidth
    \newsavebox\mytablebox
    \newlength\mytableboxwidth
    \newlength\mytableboxheight
    \newlength\mytableboxdepth
    \newcolumntype{L}[1]{>{\raggedright\hspace{0pt}}p{#1}}
    \newcolumntype{C}[1]{>{\centering\hspace{0pt}}p{#1}}
    \newcolumntype{R}[1]{>{\raggedleft\hspace{0pt}}p{#1}}
    \newcolumntype{J}[1]{>{\hspace{0pt}}p{#1}}

    % ------------------------------------------
    % savebox and length for conditional typesetting of block math
    \newsavebox\mymathbox
    \newlength\mymathboxwidth

    % ------------------------------------------
    % Command to help dmath* be pseudo-text-math
    \newcommand*\nodisplayskips{%
      \setlength\abovedisplayskip{0pt}%
      \setlength\abovedisplayshortskip{0pt}%
      \setlength\belowdisplayskip{0pt}%
      \setlength\belowdisplayshortskip{0pt}%
    }

    \newlength\figurerulewidth
    \setlength\figurerulewidth{\textwidth}
    \addtolength\figurerulewidth{-50pt}
    
    \newlength\rubberspace
    \setlength\rubberspace{3pt plus 3pt}
    
    % Give tables more vertical padding, so that math looks better
    \renewcommand{\arraystretch}{1.4}
    
    
  
    \usepackage{fancyhdr}
    \pagestyle{fancy}




